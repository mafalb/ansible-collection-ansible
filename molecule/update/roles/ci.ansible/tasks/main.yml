# Copyright (c) 2021 Markus Falb <markus.falb@mafalb.at>
# GNU General Public License v3.0+
# see LICENSE or https://www.gnu.org/licenses/gpl-3.0.txt
---

- name: debug
  debug: var=target_version|mandatory

- name: ansible virtualenv is present
  include_role:
    name: mafalb.ansible.virtualenv
  vars:
    packages:
      - ansible
      - _ansible=={{ target_version }}
      - _ansible_test
- name: check version of ansible
  block:
    - name: get ansible version
      command: "~/.virtualenvs/ansible/bin/ansible --version"
      changed_when: false
      register: __reg_ansible_version
    - name: debug ansible version
      debug: var=__reg_ansible_version
    - name: assert that ansible version is correct
      assert:
        that:
          - (__reg_ansible_version.stdout_lines[0] is search("{{ target_version }}"))

...
